CREATE TABLE ROADWAY (
  ID NUMBER(38,0) NOT NULL,
  ROADWAY_NUMBER NUMBER(38,0) NOT NULL,
  ROAD_NUMBER NUMBER(5,0) NOT NULL,
  ROAD_PART_NUMBER NUMBER(5,0) NOT NULL,
  TRACK_CODE NUMBER(2,0) NOT NULL,
  START_ADDR_M NUMBER(8,0) NOT NULL,
  END_ADDR_M NUMBER(8,0) NOT NULL,
  REVERSED NUMBER(1,0) NOT NULL,
  DISCONTINUITY NUMBER(1,0) NOT NULL,
  START_DATE DATE NOT NULL,
  END_DATE DATE,
  CREATED_BY VARCHAR2(32) NOT NULL,
  CREATE_TIME TIMESTAMP DEFAULT current_timestamp NOT NULL,
  ROAD_TYPE NUMBER(2,0) NOT NULL,
  ELY NUMBER(2,0),
  TERMINATED NUMBER(1,0) DEFAULT 0 NOT NULL,
  VALID_FROM DATE DEFAULT sysdate NOT NULL,
  VALID_TO DATE,
  CONSTRAINT ROADWAY_PK PRIMARY KEY (ID),
  CONSTRAINT ROADWAY_HISTORY_UK UNIQUE (ROAD_NUMBER, ROAD_PART_NUMBER, START_ADDR_M, END_ADDR_M,
    TRACK_CODE, DISCONTINUITY, START_DATE, END_DATE, VALID_FROM, VALID_TO, ELY, ROAD_TYPE, TERMINATED) USING INDEX,
  CONSTRAINT TERMINATION_END_DATE_CHK CHECK (TERMINATED = 0 OR (TERMINATED in (1,2) AND END_DATE IS NOT NULL))
);

CREATE TABLE LINEAR_LOCATION (
  ID NUMBER(38,0) NOT NULL,
  ROADWAY_NUMBER NUMBER(38,0) NOT NULL,
  ORDER_NUMBER NUMBER(5,0) DEFAULT 0 NOT NULL,
  LINK_ID NUMBER(38,0),
  START_MEASURE NUMBER(8,3),
  END_MEASURE NUMBER(8,3),
  SIDE_CODE NUMBER(1,0),
  CAL_START_ADDR_M NUMBER(8,0),
  CAL_END_ADDR_M NUMBER(8,0),
  LINK_SOURCE NUMBER(2,0) DEFAULT 1,
  ADJUSTED_TIMESTAMP NUMBER(13,0) DEFAULT 0 NOT NULL,
  FLOATING NUMBER(1,0) DEFAULT 0,
  GEOMETRY SDO_GEOMETRY,
  VALID_FROM DATE DEFAULT sysdate NOT NULL,
  VALID_TO DATE,
  CREATED_BY VARCHAR2(128),
  CREATE_TIME TIMESTAMP DEFAULT current_timestamp NOT NULL,
  CONSTRAINT LINEAR_LOCATION_PK PRIMARY KEY (ID),
  CONSTRAINT LINEAR_LOCATION_UK UNIQUE (ROADWAY_NUMBER, ORDER_NUMBER, LINK_ID, START_MEASURE, END_MEASURE,
    VALID_TO, CAL_START_ADDR_M, CAL_END_ADDR_M, FLOATING, SIDE_CODE, LINK_SOURCE) USING INDEX
);

CREATE TABLE EXPORT_LOCK (
  ID NUMBER(1,0) NOT NULL, 
  DESCRIPTION VARCHAR2(4000), 
  CONSTRAINT EXPORT_LOCK_CHK CHECK (id = 1),
  CONSTRAINT EXPORT_LOCK_PK PRIMARY KEY (ID)
);

CREATE TABLE MISSING_ROAD_ADDRESS (
  LINK_ID NUMBER(38,0) NOT NULL, 
  START_ADDR_M NUMBER(8,0), 
  END_ADDR_M NUMBER(8,0), 
  ROAD_NUMBER NUMBER(5,0), 
  ROAD_PART_NUMBER NUMBER(5,0), 
  ANOMALY_CODE NUMBER(2,0) NOT NULL, 
  START_M NUMBER(8,3), 
  END_M NUMBER(8,3), 
  GEOMETRY SDO_GEOMETRY
);

CREATE TABLE MUNICIPALITY (
  ID NUMBER(38,0) NOT NULL, 
  NAME_FI VARCHAR2(128), 
  NAME_SV VARCHAR2(128), 
  ELY_NRO NUMBER(2,0), 
  ROAD_MAINTAINER_ID NUMBER(38,0), 
  CONSTRAINT MUNICIPALITY_PK PRIMARY KEY (ID), 
  CONSTRAINT MUNI_ELY_MANTAINER_UK UNIQUE (ID, ELY_NRO, ROAD_MAINTAINER_ID) USING INDEX
);

CREATE TABLE PROJECT (
  ID NUMBER(38,0) NOT NULL, 
  STATE NUMBER(2,0) DEFAULT 0 NOT NULL, 
  NAME VARCHAR2(32 CHAR) NOT NULL, 
  ELY NUMBER(2,0), 
  CREATED_BY VARCHAR2(32) NOT NULL, 
  CREATED_DATE DATE DEFAULT SYSDATE NOT NULL, 
  MODIFIED_BY VARCHAR2(32), 
  MODIFIED_DATE DATE, 
  ADD_INFO VARCHAR2(1000), 
  START_DATE DATE, 
  STATUS_INFO VARCHAR2(1000), 
  CHECK_COUNTER NUMBER(38,0) DEFAULT 0 NOT NULL, 
  TR_ID NUMBER(38,0), 
  COORD_X NUMBER(10,3), 
  COORD_Y NUMBER(10,3), 
  ZOOM NUMBER(2,0), 
  CONSTRAINT PROJECT_PK PRIMARY KEY (ID)
);

CREATE TABLE PROJECT_RESERVED_ROAD_PART (
  ID NUMBER(38,0) NOT NULL, 
  ROAD_NUMBER NUMBER(5,0) NOT NULL, 
  ROAD_PART_NUMBER NUMBER(5,0) NOT NULL, 
  PROJECT_ID NUMBER(38,0) NOT NULL, 
  CREATED_BY VARCHAR2(128), 
  CONSTRAINT PROJECT_RESERVED_ROAD_PART_PK PRIMARY KEY (ID), 
  CONSTRAINT RESERVED_ROAD_UK UNIQUE (ROAD_NUMBER, ROAD_PART_NUMBER) USING INDEX,
  CONSTRAINT RESERVED_ROAD_PROJECT_UK UNIQUE (PROJECT_ID, ROAD_NUMBER, ROAD_PART_NUMBER) USING INDEX,
  CONSTRAINT PRRP_PROJECT_FK FOREIGN KEY (PROJECT_ID) REFERENCES PROJECT (ID)
);

-- TODO Why we have Project_link_history and not just have here valid_from and valid_to -fields?
CREATE TABLE PROJECT_LINK (
  ID NUMBER(38,0) NOT NULL, 
  PROJECT_ID NUMBER(38,0) NOT NULL, 
  TRACK_CODE NUMBER(2,0) NOT NULL, 
  DISCONTINUITY_TYPE NUMBER(1,0) DEFAULT 5 NOT NULL, 
  ROAD_NUMBER NUMBER(5,0) CONSTRAINT ROAD_NOT_NULL NOT NULL, 
  ROAD_PART_NUMBER NUMBER(5,0) CONSTRAINT PART_NOT_NULL NOT NULL, 
  START_ADDR_M NUMBER(8,0), 
  END_ADDR_M NUMBER(8,0), 
  CREATED_BY VARCHAR2(32) NOT NULL, 
  MODIFIED_BY VARCHAR2(32), 
  CREATED_DATE DATE DEFAULT SYSDATE NOT NULL, 
  MODIFIED_DATE DATE, 
  STATUS NUMBER(2,0), 
  CALIBRATION_POINTS NUMBER(1,0) DEFAULT 0 NOT NULL,
  ROAD_TYPE NUMBER(2,0) DEFAULT 99 NOT NULL,
  ROADWAY_ID NUMBER(38,0),
  LINEAR_LOCATION_ID NUMBER(38,0),
  CONNECTED_LINK_ID NUMBER(38,0), 
  ELY NUMBER(2,0), 
  REVERSED NUMBER(1,0) DEFAULT 0, 
  GEOMETRY VARCHAR2(4000) DEFAULT NULL, 
  SIDE_CODE NUMBER(1,0), 
  START_MEASURE NUMBER(8,3), 
  END_MEASURE NUMBER(8,3), 
  LINK_ID NUMBER(38,0), 
  ADJUSTED_TIMESTAMP NUMBER(13,0) DEFAULT 0 NOT NULL, 
  LINK_SOURCE NUMBER(2,0) DEFAULT 1, 
  CALIBRATION_POINTS_SOURCE NUMBER(2,0) DEFAULT 0, 
  CONSTRAINT PROJECT_LINK_PK PRIMARY KEY (ID),
  CONSTRAINT PROJECT_LINK_ADDRESS_CHK CHECK ((road_number is null and road_part_number is null) or
    (road_number is not null and road_part_number is not null and start_addr_m is not null and end_addr_m is not null)), 
  CONSTRAINT LINK_RESERVED_FK FOREIGN KEY (PROJECT_ID, ROAD_NUMBER, ROAD_PART_NUMBER) REFERENCES PROJECT_RESERVED_ROAD_PART (PROJECT_ID, ROAD_NUMBER, ROAD_PART_NUMBER),
  CONSTRAINT PROJECT_LINK_PROJECT_FK FOREIGN KEY (PROJECT_ID) REFERENCES PROJECT (ID) ON DELETE CASCADE,
  CONSTRAINT PROJECT_LINK_ROADWAY_FK FOREIGN KEY (ROADWAY_ID) REFERENCES ROADWAY (ID),
  CONSTRAINT PROJECT_LINK_LINEAR_LOC_FK FOREIGN KEY (LINEAR_LOCATION_ID) REFERENCES LINEAR_LOCATION (ID)
);

CREATE TABLE PROJECT_CALIBRATION_POINT (
  ID NUMBER(38,0) NOT NULL, 
  PROJECT_LINK_ID NUMBER(38,0) NOT NULL, 
  PROJECT_ID NUMBER(38,0) NOT NULL, 
  LINK_M NUMBER(8,3) NOT NULL, 
  ADDRESS_M NUMBER(8,0) NOT NULL, 
  CONSTRAINT PROJECT_CALIBRATION_POINT_PK PRIMARY KEY (ID),
  CONSTRAINT PCALPOINT_PLINK_FK FOREIGN KEY (PROJECT_LINK_ID) REFERENCES PROJECT_LINK (ID) ON DELETE CASCADE,
  CONSTRAINT PCALPOINT_PROJECT_FK FOREIGN KEY (PROJECT_ID) REFERENCES PROJECT (ID) ON DELETE CASCADE
);

-- TODO Why we have Project_link_history and not just have here valid_from and valid_to -fields?
CREATE TABLE PROJECT_LINK_HISTORY (
  ID NUMBER(38,0) NOT NULL, 
  PROJECT_ID NUMBER(38,0) NOT NULL, 
  TRACK_CODE NUMBER(2,0) NOT NULL, 
  DISCONTINUITY_TYPE NUMBER(1,0) DEFAULT 5 NOT NULL, 
  ROAD_NUMBER NUMBER(5,0), 
  ROAD_PART_NUMBER NUMBER(5,0), 
  START_ADDR_M NUMBER(8,0), 
  END_ADDR_M NUMBER(8,0), 
  CREATED_BY VARCHAR2(32) NOT NULL, 
  MODIFIED_BY VARCHAR2(32), 
  CREATED_DATE DATE DEFAULT SYSDATE NOT NULL, 
  MODIFIED_DATE DATE, 
  STATUS NUMBER(2,0), 
  CALIBRATION_POINTS NUMBER(1,0) DEFAULT 0 NOT NULL, 
  ROAD_TYPE NUMBER(2,0) DEFAULT 99 NOT NULL, 
  ROADWAY_ID NUMBER(38,0),
  LINEAR_LOCATION_ID NUMBER(38,0),
  CONNECTED_LINK_ID NUMBER(38,0), 
  ELY NUMBER(2,0), 
  REVERSED NUMBER(1,0) DEFAULT 0, 
  GEOMETRY VARCHAR2(4000) DEFAULT NULL, 
  SIDE_CODE NUMBER(5,0), 
  START_MEASURE NUMBER(8,3), 
  END_MEASURE NUMBER(8,3), 
  LINK_ID NUMBER(38,0), 
  ADJUSTED_TIMESTAMP NUMBER(38,0) DEFAULT 0 NOT NULL, 
  LINK_SOURCE NUMBER(2,0) DEFAULT (1), 
  CALIBRATION_POINTS_SOURCE NUMBER(2,0) DEFAULT 0, 
  CONSTRAINT PROJECT_LINK_HIST_PROJECT_FK FOREIGN KEY (PROJECT_ID) REFERENCES PROJECT (ID) ON DELETE CASCADE
);

CREATE TABLE PROJECT_LINK_NAME (
  ID NUMBER(38,0) NOT NULL, 
  PROJECT_ID NUMBER(38,0), 
  ROAD_NUMBER NUMBER(5,0), 
  ROAD_NAME VARCHAR2(255), 
  CONSTRAINT PROJECT_LINK_NAME_PK PRIMARY KEY (ID), 
  CONSTRAINT PROJECT_LINK_NAME_UK UNIQUE (PROJECT_ID, ROAD_NUMBER) USING INDEX,
  CONSTRAINT PROJECT_LINK_NAME_PROJECT_FK FOREIGN KEY (PROJECT_ID) REFERENCES PROJECT (ID)
);

CREATE TABLE PUBLISHED_ROAD_NETWORK (
  ID NUMBER(38,0) NOT NULL, 
  CREATED TIMESTAMP (6) NOT NULL, 
  VALID_TO TIMESTAMP (6), 
  CONSTRAINT PUBLISHED_ROAD_NETWORK_PK PRIMARY KEY (ID)
);

CREATE TABLE PUBLISHED_ROADWAY (
  NETWORK_ID NUMBER(38,0) NOT NULL,
  ROADWAY_ID NUMBER(38,0) NOT NULL,
  CONSTRAINT PUBLISHED_ROADWAY_PK PRIMARY KEY (NETWORK_ID, ROADWAY_ID),
  CONSTRAINT PUBROADADDR_PUBROADNETWORK_FK FOREIGN KEY (NETWORK_ID) REFERENCES PUBLISHED_ROAD_NETWORK (ID),
  CONSTRAINT PUBROADADDR_ROADWAY_FK FOREIGN KEY (ROADWAY_ID) REFERENCES ROADWAY (ID)
);

CREATE TABLE ROAD_NETWORK_ERROR (
  ID NUMBER(38,0) NOT NULL, 
  ROADWAY_ID NUMBER(38,0) NOT NULL,
  LINEAR_LOCATION_ID NUMBER(38,0),
  ERROR_CODE NUMBER(38,0) NOT NULL, 
  ERROR_TIMESTAMP NUMBER(38,0) DEFAULT 0, 
  ROAD_NETWORK_VERSION NUMBER(38,0), 
  CONSTRAINT ROAD_NETWORK_ERROR_PK PRIMARY KEY (ID),
  CONSTRAINT ADDRESS_ERROR_VERSION_UK UNIQUE (ROADWAY_ID, ERROR_CODE, ROAD_NETWORK_VERSION) USING INDEX,
  CONSTRAINT RNE_ROADWAY_FK FOREIGN KEY (ROADWAY_ID) REFERENCES ROADWAY (ID),
  CONSTRAINT RNE_LL_FK FOREIGN KEY (LINEAR_LOCATION_ID) REFERENCES LINEAR_LOCATION (ID),
  CONSTRAINT ROAD_NETWORK_FK FOREIGN KEY (ROAD_NETWORK_VERSION) REFERENCES PUBLISHED_ROAD_NETWORK (ID) ON DELETE CASCADE
);

CREATE TABLE ROADWAY_CHANGES (
  PROJECT_ID NUMBER(38,0) NOT NULL, 
  CHANGE_TYPE NUMBER(2,0) NOT NULL,
  OLD_ROAD_NUMBER NUMBER(5,0), 
  NEW_ROAD_NUMBER NUMBER(5,0), 
  OLD_ROAD_PART_NUMBER NUMBER(5,0), 
  NEW_ROAD_PART_NUMBER NUMBER(5,0), 
  OLD_TRACK_CODE NUMBER(2,0), 
  NEW_TRACK_CODE NUMBER(2,0), 
  OLD_START_ADDR_M NUMBER(8,0), 
  NEW_START_ADDR_M NUMBER(8,0), 
  OLD_END_ADDR_M NUMBER(8,0), 
  NEW_END_ADDR_M NUMBER(8,0), 
  NEW_DISCONTINUITY NUMBER(1,0) NOT NULL, 
  NEW_ROAD_TYPE NUMBER(2,0) NOT NULL, 
  NEW_ELY NUMBER(2,0) NOT NULL, 
  OLD_ROAD_TYPE NUMBER(2,0), 
  OLD_DISCONTINUITY NUMBER(1,0), 
  OLD_ELY NUMBER(2,0), 
  REVERSED NUMBER(1,0) DEFAULT 0
);

CREATE TABLE ROAD_NAME (
  ID NUMBER(38,0) NOT NULL, 
  ROAD_NUMBER NUMBER(5,0) NOT NULL, 
  ROAD_NAME VARCHAR2(255) NOT NULL, 
  START_DATE DATE NOT NULL, 
  END_DATE DATE, 
  VALID_FROM DATE DEFAULT sysdate NOT NULL,
  VALID_TO DATE, 
  CREATED_BY VARCHAR2(32) NOT NULL, 
  CREATED_TIME TIMESTAMP (6) DEFAULT CURRENT_TIMESTAMP, 
  CONSTRAINT ROAD_NAME_PK PRIMARY KEY (ID)
);

CREATE TABLE SERVICE_USER (
  ID NUMBER(38,0) NOT NULL, 
  USERNAME VARCHAR2(256) NOT NULL, 
  CONFIGURATION VARCHAR2(4000), 
  CONSTRAINT SERVICE_USER_UK UNIQUE (USERNAME) USING INDEX,
  CONSTRAINT SERVICE_USER_PK PRIMARY KEY (ID)
);

CREATE GLOBAL TEMPORARY TABLE TEMP_ID (
  ID NUMBER(38,0) NOT NULL, 
  CONSTRAINT TEMP_ID_PK PRIMARY KEY (ID)
) ON COMMIT DELETE ROWS;
